<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReSpark - Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body class="pb-32 md:pb-8">
    <div class="aurora-bg"></div>

    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-slate-800">Your Impact</h1>
        <div class="max-w-md mx-auto">
            <div class="glass-card text-center p-6 mb-8">
                <p class="text-slate-500">Total Spark Points</p>
                <p id="total-points" class="text-6xl font-bold text-sky-500">0</p>
            </div>

            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4 text-slate-700">Milestones</h2>
                <div id="milestones-container" class="space-y-4">
                    <!--  milestones  -->
                </div>
            </div>
            
            <div>
                 <h2 class="text-xl font-semibold mb-4 text-slate-700">Available Rewards</h2>
                 <div id="rewards-container" class="space-y-4">
                    <!-- rewards-->
                 </div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav flex justify-around">
        <a href="index.html" class="nav-link flex-grow flex flex-col items-center justify-center p-2 text-slate-500 transition-transform">
            <div class="nav-icon-bg h-8 w-12 rounded-full flex items-center justify-center transition-all">
                 <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6z"></path></svg>
            </div>
            <span class="text-xs mt-1">Dashboard</span>
        </a>
        <a href="profile.html" class="nav-link active flex-grow flex flex-col items-center justify-center p-2 transition-transform">
            <div class="nav-icon-bg h-8 w-12 rounded-full flex items-center justify-center transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            </div>
            <span class="text-xs mt-1">Profile</span>
        </a>
    </nav>
    
    <script src="./js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const profile = getProfile();
            document.getElementById('total-points').textContent = profile.sparkPoints;

            const allMilestones = [
                { id: 'ms1', points: 50,  title: 'Eco Starter', icon: 'ðŸŒ±' },
                { id: 'ms2', points: 300, title: 'Repair Apprentice', icon: 'ðŸ› ï¸' },
                { id: 'ms3', points: 800, title: 'Life Extender', icon: 'â³' },
                { id: 'ms4', points: 1500, title: 'Circular Champion', icon: 'ðŸ†' }
            ];

            const allRewards = [
                { id: 'rw1', milestoneId: 'ms1', title: '5% Off at Green Gadgets', cost: 100 },
                { id: 'rw2', milestoneId: 'ms2', title: '10% Off at QuickFix', cost: 500 },
                { id: 'rw3', milestoneId: 'ms3', title: 'Free Coffee at EcoCafe', cost: 1000 },
            ];

            const milestonesContainer = document.getElementById('milestones-container');
            const rewardsContainer = document.getElementById('rewards-container');

            allMilestones.forEach(ms => {
                const achieved = profile.sparkPoints >= ms.points;
                const element = document.createElement('div');
                element.className = `glass-card p-4 flex items-center justify-between transition-opacity ${achieved ? '' : 'opacity-40'}`;
                
                element.innerHTML = `
                    <div class="flex items-center">
                        <div class="milestone-icon h-12 w-12 rounded-lg flex items-center justify-center ${achieved ? 'bg-emerald-500 text-white' : 'bg-slate-200'} text-2xl mr-4">${ms.icon}</div>
                        <div>
                            <h4 class="font-semibold">${ms.title}</h4>
                            <p class="text-sm text-slate-500">Earn ${ms.points} Spark Points</p>
                        </div>
                    </div>
                    ${achieved ? `<button data-sharer-text="I just became an ${ms.title} on ReSpark! Join the pre-cycling revolution at respark.dev" class="share-btn p-2 rounded-full hover:bg-slate-200">
                        <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.368a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg>
                    </button>` : ''}
                `;
                milestonesContainer.appendChild(element);
            });

            rewardsContainer.innerHTML = '';
            allRewards.forEach(rw => {
                const lastAchievedMilestone = allMilestones.slice().reverse().find(ms => profile.sparkPoints >= ms.points);
                const isRedeemed = profile.redeemedRewards.includes(rw.id);

                if (lastAchievedMilestone && lastAchievedMilestone.id === rw.milestoneId && !isRedeemed) {
                    const element = document.createElement('div');
                    element.className = 'glass-card p-4 flex items-center justify-between';
                    element.innerHTML = `
                        <div>
                            <h4 class="font-semibold">${rw.title}</h4>
                            <p class="text-sm text-slate-500">Cost: ${rw.cost} Points</p>
                        </div>
                        <button data-reward-id="${rw.id}" data-cost="${rw.cost}" class="redeem-btn bg-sky-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-600">Redeem</button>
                    `;
                    rewardsContainer.appendChild(element);
                }
            });
            if (rewardsContainer.innerHTML === '') {
                rewardsContainer.innerHTML = '<p class="text-center text-slate-400 italic">Unlock more milestones to see new rewards!</p>';
            }

            document.querySelectorAll('.share-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const textToShare = e.currentTarget.getAttribute('data-sharer-text');
                    if (navigator.share) {
                        navigator.share({ title: 'My ReSpark Achievement!', text: textToShare }).catch(console.error);
                    } else {
                        alert('Sharing is supported on mobile devices. Here is your text:\n\n' + textToShare);
                    }
                });
            });

            document.querySelectorAll('.redeem-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const rewardId = e.currentTarget.getAttribute('data-reward-id');
                    const cost = parseInt(e.currentTarget.getAttribute('data-cost'));
                    
                    if (redeemReward(rewardId, cost)) {
                        alert('Reward redeemed! Your points have been updated.');
                        window.location.reload();
                    } else {
                        alert('Not enough points to redeem this reward.');
                    }
                });
            });
        });
    </script>
</body>
</html>
